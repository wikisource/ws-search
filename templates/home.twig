{% extends "base.twig" %}
{% block content %}

    <form method="get" action="{{baseurl}}/" class="well">
        <p>
            Use this form to search {{totalWorks|number_format}} works
            hosted on {{langs|length|number_format}}
            <a href="https://wikisource.org/">Wikisource</a> projects.
        </p>
        <p class="form-group">
            <label class="control-label">Language:</label>
            <select name="lang" class="form-control">
                {% for l in langs %}
                <option value="{{l.code}}" {% if l.code == lang %}selected{% endif %}>
                    {{l.code}} &mdash; {{l.label}}
                </option>
                {% endfor %}
            </select>
        </p>
        <p class="form-group">
            <label class="control-label">Title:</label>
            <input type="text" name="title" class="form-control" value="{{form_vals.title}}" />
        </p>
        <p class="form-group">
            <label class="control-label">Author:</label>
            <input type="text" name="author" class="form-control" value="{{form_vals.author}}" />
        </p>
        <p class="form-group">
            <input type="submit" value="Search" class="btn btn-info" />
        </p>
    </form>

    {% if works %}
    <p class="alert alert-success">{{works|length|number_format}} works found.</p>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Wikidata</th>
                <th>Title</th>
                <th>Authors</th>
                <th>Year</th>
                <th>Categories</th>
                <th>Index pages</th>
                <th>Download</th>
            </tr>
        </thead>
        <tbody>
            {% for work in works %}
            <tr>
                <td>
                    {% if work.wikidata_item %}
                    <a href="https://wikidata.org/wiki/{{work.wikidata_item}}">
                        {{work.wikidata_item}}
                    </a>
                    {% endif %}
                </td>
                <td>
                    <a href="https://{{lang}}.wikisource.org/wiki/{{work.pagename|escape('url')}}">
                        {{work.title}}
                    </a>
                </td>
                <td>
                    <ol class="list-unstyled">
                    {% for author in work.authors %}
                        <li>{{author.pagename}}</li>
                    {% endfor %}
                    <ol>
                </td>
                <td>{{work.year}}</td>
                <td>
                    <!-- Categories go here -->
                </td>
                <td>
                    <ol class="list-unstyled">
                    {% for ip in work.indexPages %}
                        <li><a href="https://{{lang}}.wikisource.org/wiki/{{ip.pagename|escape('url')}}">{{ip.pagename}}</a></li>
                    {% endfor %}
                    <ol>
                </td>
                <td class="nowrap">

                    <a href="https://tools.wmflabs.org/wsexport/tool/book.php?lang={{lang}}&format=epub-3&page={{work.pagename|escape('url')}}" title="Download EPUB">
                    <img src='https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/EPUB_silk_icon.svg/15px-EPUB_silk_icon.svg.png' />
                </a>

                <a href="https://tools.wmflabs.org/wsexport/tool/book.php?lang={{lang}}&format=pdf-a4&page={{work.pagename|escape('url')}}" title="Download PDF">
                    <img src='https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Pdfreaders-f.svg/15px-Pdfreaders-f.svg.png' />
                </a>

                {% if book.index_page %}
                <a href="https://{{lang}}.wikisource.org/wiki/{{book.index_page}}">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Open_book_nae_02.svg/20px-Open_book_nae_02.svg.png" />
                </a>
                {% endif %}

                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% endif %}

{% endblock %}

